<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DHX</title>
  <meta name="viewport" content="width=1024, user-scalable=no">

  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="STIILID.css" id="jsbin-css">	

</head>

<body>
	<div class="container">
		<div class="row">
			<div class="col-md-9">


<img src="infosys_vapp_est_78px.png">

<h3 id="dokumendivahetusprotokoll-dhx">Dokumendivahetusprotokoll DHX</h3>

<p>Riigi Infosüsteemi Amet</p>

<p><em>kavand v 0.9</em></p>



<h4 id="sisukord">Sisukord</h4>

<p><a href="Protokoll.md#1-Ülevaade">1 Ülevaade</a> <br>
  - <a href="Protokoll.md#11-protokolli-k%C3%A4sitlusala">1.1 Protokolli käsitlusala</a> <br>
  - <a href="Protokoll.md#12-dokumendi-eesm%C3%A4rk">1.2 Dokumendi eesmärk</a> <br>
  - <a href="Protokoll.md#13-v%C3%A4ljat%C3%B6%C3%B6tamine">1.3 Väljatöötamine</a> <br>
  - <a href="#14-disaini-kaalutlused">1.4 Disaini kaalutlused</a></p>

<p><a href="Protokoll.md#2-nõuete-keel">2 Nõuete keel</a></p>

<p><a href="Protokoll.md#3-mõisted-ja-lühendid">3 Mõisted ja lühendid</a></p>

<p><a href="Protokoll.md#4-lähteolukord">4 Lähteolukord</a></p>

<p><a href="Protokoll.md#5-dhx-teenus">5 DHX teenus</a></p>

<ul>
<li><a href="Protokoll.md#51-Üldiseloomustus">5.1 Üldiseloomustus</a></li>
<li><a href="Protokoll.md#52-dhx-teenuse-väljaarendamine">5.2 DHX teenuse väljaarendamine</a></li>
<li><a href="Protokoll.md#53-dhx-teenuse-avamine">5.3 DHX teenuse avamine</a></li>
<li><a href="Protokoll.md#54-nimemuster">5.4 Nimemuster</a></li>
<li><a href="Protokoll.md#55-reserveeritud-nimi-dhx">5.5 Reserveeritud nimi “DHX”</a></li>
<li><a href="Protokoll.md#56-kapsli-kasutamine">5.6 Kapsli kasutamine</a></li>
<li><a href="Protokoll.md#57-unikaalne-identifikaator">5.7 Unikaalne identifikaator</a></li>
</ul>

<p><a href="Protokoll.md#6-vahendamine">6 Vahendamine</a></p>

<ul>
<li><a href="Protokoll.md#61-vahendamise-mõiste">6.1 Vahendamise mõiste</a></li>
<li><a href="Protokoll.md#62-vahendajate-nimekiri">6.2 Vahendajate nimekiri</a></li>
<li><a href="Protokoll.md#63-vahendusnimekiri">6.3 Vahendusnimekiri</a></li>
</ul>

<p><a href="Protokoll.md#7-saatmine">7 Saatmine</a></p>

<ul>
<li><a href="#71-dhx-võimekus">7.1 DHX võimekus</a></li>
<li><a href="#72-otsevõimekuse-väljaselgitamine">7.2 Otsevõimekuse väljaselgitamine</a></li>
<li><a href="#73-v%C3%B5imekus-l%C3%A4bi-vahendaja">7.3 Võimekus läbi vahendaja</a></li>
<li><a href="#74-lokaalne-aadressiraamat">7.4 Lokaalne aadressiraamat</a></li>
<li><a href="#75-saatmine-dvk-sse">7.5 Saatmine DVK-sse</a> </li>
<li><a href="#76-dokumendi-lugemine-edastatuks">7.6 Dokumendi lugemine edastatuks</a></li>
<li><a href="#77-uuesti-üritamine">7.7 Uuesti üritamine</a></li>
<li><a href="#78-saatmisalgoritm-informatiivne">7.8 Saatmisalgoritm (informatiivne)</a></li>
</ul>

<p><a href="Protokoll.md#8-vastuvõtmine">8 Vastuvõtmine</a></p>

<ul>
<li><a href="Protokoll.md#81-aadressi-kontroll">8.1 Aadressi kontroll</a></li>
<li><a href="Protokoll.md#82-valest-aadressist-teatamine">8.2 Valest aadressist teatamine</a></li>
<li><a href="Protokoll.md#83-kapsli-kontroll">8.3 Kapsli kontroll</a></li>
<li><a href="Protokoll.md#84-mitme-aadressi-käsitlus">8.4 Mitme aadressi käsitlus</a></li>
<li><a href="Protokoll.md#85-vastuvõtmine-dvk-st">8.5 Vastuvõtmine DVK-st</a></li>
<li><a href="#86-saatja-kindlakstegemine">8.6 Saatja kindlakstegemine</a></li>
</ul>

<p><a href="Protokoll.md#9-Üleminek">9 Üleminek</a></p>

<ul>
<li><a href="Protokoll.md#91-Üleminekuperiood">9.1 Üleminekuperiood</a></li>
<li><a href="Protokoll.md#92-dvk-toimimine-üleminekuperioodil">9.2 DVK toimimine üleminekuperioodil</a></li>
</ul>

<p><a href="Protokoll.md#10-vastavusn%C3%B5uded">10 Vastavusnõuded</a>  </p>

<p><a href="Protokoll.md#viited">Viited</a></p>

<p><a href="Protokoll.md#lisa-1-senddocument-spetsifikatsioon">Lisa 1 sendDocument spetsifikatsioon</a></p>

<p><a href="#lisa-2-representationlist-spetsifikatsioon">Lisa 2 representationList spetsifikatsioon</a></p>

<p>Joonised: <br>
 - Joonis 1 <a href="Protokoll.md#4-lähteolukord">Lähteolukord: dokumendivahetus DVK kaudu</a> <br>
 - Joonis 2 <a href="Protokoll.md#5-dhx-teenus">DHX põhiskeem</a> <br>
 - Joonis 3 <a href="Protokoll.md#6-vahendamine">DHX teenusevahendamine</a> <br>
 - Joonis 4  <a href="Protokoll.md#9-Üleminek">Toimimine üleminekuperioodil</a> </p>



<h4 id="1-ülevaade">1 Ülevaade</h4>



<h4 id="11-protokolli-käsitlusala">1.1 Protokolli käsitlusala</h4>

<p>Dokumendivahetusprotokoll DHX on standarditud tehniline ja organisatsiooniline lahendus, mis võimaldab asutustel vahetada dokumente hajus- e detsentraliseeritud põhimõttel.</p>

<p>DHX võimaldab elektroonilist dokumendivahetust korraldada detsentraliseeritult, ilma keskse postitöötlemissõlmeta. Erinevalt vanemast Dokumendivahetuskeskusest (DVK) ei nõua DHX dokumendihaldussüsteemidelt (DHS) enam “postkontoris” posti järel käimist, vaid dokumendid liiguvad otse saatjalt saajale.</p>

<p>Protokoll ei nõua individuaalseid (bilateraalseid) kokkuleppeid, häälestusi, liideste ehitamist vms dokumente vahetavate asutuste vahel. Protokolli järgiv asutus saab teisele asutusele saata dokumendi ilma mingi varasema kontaktita kahe asutuse vahel.</p>

<p>DHX on mõeldud eelkõige avaliku sektori dokumendivahetuse turvaliseks ja kuluefektiivseks korraldamiseks, kuid skeem on laiendatav ka era- ja vabasektori organisatsioonidele.</p>

<p>DHX toetab andmeteenuse vahendamist (X-tee mõistes).</p>

<p>DHX kasutab X-tee taristut.</p>

<p>Protokoll eeldab rakendavate osapoolte motivatsiooni dokumendivahetust efektiivselt ja turvaliselt korraldada: saatja tahet dokumente saata ja vastuvõtja tahet dokumente saada.</p>



<h4 id="12-dokumendi-eesmärk">1.2 Dokumendi eesmärk</h4>

<p>Käesolev dokument määratleb vastavusnõuded, andmevormingud, töötlus- ja menetlusloogikad kõigile DHX-i rakendamisega seotud osapooltele - DHX-i rakendavatele asutustele, DHX-i vahendajatele ja X-tee keskusele. Samuti käsitletakse üleminekut seni DVK kaudu korraldatud dokumendivahetuselt DHX-i kasutamisele.</p>



<h4 id="13-väljatöötamine">1.3 Väljatöötamine</h4>

<p>Protokolli koostamisel on lähtutud protokollide spetsifitseerimise parimast praktikast [RIA-PP].</p>

<p>Protokoll on kujundatud avastandardina.</p>

<hr>

<p>Märkus (informatiivne). <br>
Interneti standardimise organisatsioon IETF ([RFC 6852]) seab avastandardi (ingl <em>open standard</em>) kriteeriumiteks: <br>
- kohast protsessi (ingl <em>due process</em>): <br>
  - otsuseid tehakse osapoolte suhtes õiglaselt <br>
  - standardiloome protsess on läbipaistev <br>
    - jälg aruteludest <br>
    - avaliku kommenteerimise periood enne lõplikku heakskiitmist ja kasutuselevõttu <br>
    - perioodilise läbivaatuse ja täiendamise protsessid on selgelt määratletud <br>
- laiahaardelist konsensust (ingl <em>broad consensus</em>) <br>
- läbipaistvust <br>
- tasakaalustatust - standardimistegevuses ei domineeri ükski konkreetne isik, ettevõte või huvirühm <br>
- vabatahtlikku kasutuselevõttu. IETF on seisukohal, et standardi edukuse määrab lõppkokkuvõttes turg._</p>

<hr>

<p>Protokolli on välja töötanud Riigi Infosüsteemi Amet.</p>

<p>Protokollis on arvestatud projekti “Dokumendivahetustaristu hajusarhitektuurile üleviimise väljatöötamine” raames mai-juuni 2016 läbiviidud analüüsi (täitja BPW Consulting OÜ) raportis esitatud ettepanekuid ja soovitusi. </p>

<p>Ettepanekud ja märkused palume saata help@ria.ee või luua käesolevas varamus <code>Issue</code>.</p>

<p>Protokolli saab kasutada MIT litsentsi [MIT] alusel.</p>



<h4 id="14-disaini-kaalutlused">1.4 Disaini kaalutlused</h4>

<p>Protokolli kavandamisel on lähtutud hajusa dokumendivahetuse lahendusele püstitatud ärinõuetest:</p>

<ul>
<li><strong>hajusus</strong> - lahendus ei tohi nõuda keskset sõlme ega muid keskseid komponente, v.a X-tee taristu poolt pakutavad võimalused (X-tee identimis- ja adresseerimissüsteem, X-tee metateenused).</li>
<li><strong>kohaletoimetatavus</strong> - lahendus peab võimaldama dokumente garanteeritult kätte toimetada kõigile X-teega liitunud asutustele, kes DHX-i kasutusele võtavad.</li>
<li><strong>adresseeritavus</strong> - saatjal peab olema adressaadi nime järgi võimalik kergesti leida aadress, millel dokument teele panna.</li>
<li>turvalisus - saadetav dokument peab jõudma õige adressaadini ja ainult temani.</li>
<li><strong>kiire</strong> - dokumendi teeloleku aeg peab olema lühike, mitte pikem kui DVK lahenduses.</li>
<li><strong>õiguspärane</strong> - lahendus peab vastama kehtivale õigusele või esitatakse realistlikud ettepanekud õiguse muutmiseks.</li>
<li><strong>lihtsalt teostatav</strong> - tehniline teostus peab olema lihtne, DHS-des nõutavad arendustööd - minimaalse maksumusega.</li>
<li><strong>madala käitluskuluga</strong> - lahendus ei tohi panna DHS-de haldajatele täiendavat süsteemihaldamise koormust.</li>
<li><strong>e-arvete liiklust võimaldav</strong> - lahenduses peab säilitama senise DVKga samaväärse võimaluse töödelda e-arveid.</li>
<li><strong>agnostiline dokumenditüübi suhtes</strong> - protokoll ei tohi seada piiranguid vahetatavate dokumentide tüüpidele, peale dokumendivahetuse “kapsli” (vt [DHX]) kasutamise.</li>
<li><strong>minimaalne</strong> - protokollis ei tohi olla ärinõuete täitmise suhtes vähetähtsaid elemente.</li>
<li><strong>aluskihina toimimise võimeline</strong> - protokolli peale peab olema võimalik rajada edasisi kokkuleppeid.</li>
<li><strong>X-tee versiooni 6 toetav</strong> - protokoll peab toimima X-tee versioonis 6; X-tee varasemate versioonide tugi ei ole vajalik.</li>
<li><strong>probleemideta üleminek</strong> - hajuslahendusele üleminek peab olema kavandatud nii tehniliselt kui ka organisatsioonilises vaates; - üleminek peab olema sujuv; ülemineku riskid peavad olema asjakohaste meedetega maandatud.</li>
<li><strong>statistikavajaduse rahuldamine</strong> - dokumendivahetuse statistika erinevate kasutajate teabevajadused peavad olema arvesse võetud.</li>
<li><strong>kasutusmugavuse säilimine</strong> - DHX-i kasutusel ja ka üleminekuperioodil peab säilima (võib paraneda) tänane DVK kasutusmugavus kasutajale.</li>
</ul>

<p>Üksteisele vastutöötavate ärinõuete korral on püütud leida tasakaalustatud lahendus. </p>



<h4 id="2-nõuete-keel">2 Nõuete keel</h4>

<ol>
<li><p>Normatiivse tähendusega on käesolev tekst koos lisadega, v.a sõnaga “informatiivne” tähistatud osad. GitHub-i varamu muul sisul on informatiivne tähendus.</p></li>
<li><p>Läbiva suurtähega esitatud sõnu tuleb tõlgendada järgmiselt (vrdl [RFC 2119]):</p>

<ul><li>”PEAB”, “TOHIB AINULT” - protokolli implementeerija ei saa deklareerida protokollile vastavust, kui nõue on täitmata.</li>
<li>“PEAKS” - nõue ei pea tingimata olema implementeeritud, kuid implementatsiooni saab lugeda protokollile vastavaks ainult siis, kui nõude täitmisest kõrvalekaldumiseks on kaalukas põhjus.</li>
<li>“VÕIB” - omadust võib implementeerida; mitteimplementeerimist ei pea põhjendama.</li></ul></li>
</ol>



<h4 id="3-mõisted-ja-lühendid">3 Mõisted ja lühendid</h4>

<table>
<thead>
<tr>
  <th>mõiste</th>
  <th>seletus</th>
</tr>
</thead>
<tbody><tr>
  <td><em>adressaat</em></td>
  <td>ingl <em>adressee</em>, asutus, kellele tahetakse dokumenti saata. Adressaadi määrab üheselt asutuse registrikood. Samatähenduslik sõnaga “saaja”.</td>
</tr>
<tr>
  <td><em>asutus</em></td>
  <td>DHX dokumendivahetuses osalev organisatsioon. Eelkõige Eesti avaliku sektori asutus, aga võib olla ka ettevõte või vabasektori organisatsioon. Asutuselt eeldatakse ametlikku registrisse (riigi ja kohaliku omavalitsuse asutuste riiklik register (RKOARR), äriregister, mittetulundusasutuste register) kantust ja registrikoodi olemasolu.</td>
</tr>
<tr>
  <td><em>DHX-i dokumendivahetus</em></td>
  <td>dokumentide vahetus X-teel vastavalt DHX protokollile.</td>
</tr>
<tr>
  <td><em>DHX-i otserakendamine</em></td>
  <td>DHX-i otse, st ilma vahendajata rakendamine.</td>
</tr>
<tr>
  <td><em>DHX-i otsevõimekus</em></td>
  <td>kui asutus on loonud võimekuse DHX-i rakendada ilma vahendajata, siis ütleme, et asutusel on DHX-i otsevõimekus.</td>
</tr>
<tr>
  <td><em>DHX-i rakendaja</em></td>
  <td>asutus, kes kasutab DHX-i.</td>
</tr>
<tr>
  <td><em>DHX-i rakendamine</em></td>
  <td>DHX-i kasutamine, täites kõik DHX-i vastavusnõuded. DHX-i võib rakendada otse või vahendaja kaudu.</td>
</tr>
<tr>
  <td><em>DHX-i võimekus vahendaja kaudu</em></td>
  <td>DHX-i kasutamine läbi vahendaja. Vt DHX otserakendamine.</td>
</tr>
<tr>
  <td><em>DHX-i võimekus</em></td>
  <td>asutuse võimekus saata ja vastu võtta dokumente vastavalt DHX protokollile. DHX võimekuse võib teostada kas otse (vt DHX otsevõimekus) või läbi vahendaja (vt DHX võimekus vahendaja kaudu).</td>
</tr>
<tr>
  <td><em>DHX teenus</em></td>
  <td>standarditud nimemustriga <code>EE/GOV/&lt;registrikood&gt;/DHX/sendDocument</code> X-tee teenus, mille kaudu DHX-i otserakendaja või vahendaja võtab vastu dokumente.</td>
</tr>
<tr>
  <td><em>DHX vahendamine</em></td>
  <td>X-tee kasutusmuster, kus vahendaja rollis tegutsev X-tee liige (DHX vahendaja) võimaldab oma infosüsteemi vahendusel asutuse juurdepääsu DHX dokumendivahetusele. Vt DHX-i otserakendamine.</td>
</tr>
<tr>
  <td><em>DHX vahendaja</em>, pikemalt <em>DHX dokumendivahetusteenuse vahendaja</em>, lühidalt lihtsalt <em>vahendaja</em></td>
  <td>X-tee liige, kes osutab asutusele teenust, vahendades DHX dokumendiedastust. Tüüpiliselt DHS-i pilve- või majutusteenuse osutaja; võib olla nii erasektori teenuseosutaja kui ka avaliku sektori asutus, kes osutab teenust teisele asutusele.</td>
</tr>
<tr>
  <td><em>DHX vahendajate grupp</em></td>
  <td>tehniline abinõu DHX vahendajate nimekirja pidamiseks. DHX vahendajate grupp on osa X-tee globaalsest konfiguratsioonist.</td>
</tr>
<tr>
  <td><em>DHX vahendajate nimekiri</em></td>
  <td>X-tee keskuse (RIA) poolt peetav nimekiri DHX dokumendivahetusteenuse vahendajatest.</td>
</tr>
<tr>
  <td><em>DHS pilveteenusena</em></td>
  <td>suhe, kus üks organisatsioon (ettevõte või teine asutus) pakub asutusele DHS-i tehnilist keskkonda. Ühes tehnilises keskkonnas võib olla mitu “virtuaalset” DHS-i. Näiteks Majandus- ja Kommunikatsiooniministeerium pakub DHS-i teenust ministeeriumi haldusala asutustele; Koolide infosüsteem KIS pakub DHS-i teenust reale lasteaedadele. DHS pilveteenusena ja DHX vahendamine võivad olla ühitatud, kuid on siiski erinevad mõisted. Majutaja ei pea alati olema vahendaja. Vahendussuhe on siis, kui X-tee liiklus käib vahendaja sertifikaadiga.</td>
</tr>
<tr>
  <td><em>dokument</em></td>
  <td>asutuses töödeldav dokument Eesti avaliku sektori dokumendihalduse tähenduses. Võib koosneda mitmest failist. Edastatakse elektroonilise dokumendivahetuse kapslis.</td>
</tr>
<tr>
  <td><em>dokumendihaldussüsteem</em>, <em>DHS</em></td>
  <td>asutuse elektroonilise dokumendihalduse, sh dokumendivahetuse teenindamisele spetsialiseerunud infosüsteem.</td>
</tr>
<tr>
  <td><em>elektroonilise dokumendivahetuse kapsel</em></td>
  <td>lühidalt “kapsel” - dokumenti ja metaandmeid sisaldav XML-struktuur.</td>
</tr>
<tr>
  <td><em>globaalne konfiguratsioon</em></td>
  <td>X-tee metaandmekogum, nimekiri X-tee liikmetest, alamsüsteemidest ja gruppidest. Vt [PR-GCONF], [PR-META].</td>
</tr>
<tr>
  <td><em>DVK</em></td>
  <td>Dokumendivahetuskeskus [DVK].</td>
</tr>
<tr>
  <td><em>RIA</em></td>
  <td>Riigi Infosüsteemi Amet.</td>
</tr>
<tr>
  <td><em>registrikood</em></td>
  <td>asutuse ametlik registrikood. Nt <code>70002093</code> <code>Kadrioru lasteaed</code>.</td>
</tr>
<tr>
  <td><em>vastuvõttev süsteem</em></td>
  <td>dokumenti X-teel DHX protokolli kohaselt vastuvõttev infosüsteem (võib olla ka vahendaja infosüsteem ja üleminekuperioodil DVK).</td>
</tr>
<tr>
  <td><em>saadetis</em></td>
  <td>ingl <em>consignment</em>, dokument, mida saatev süsteem üritab vastuvõtvale süsteemile saata. Ebaõnnestumise korral tehakse mitu üritust.</td>
</tr>
<tr>
  <td><em>saadetise id</em></td>
  <td>ingl <em>consignment id</em>, dokumendi saatmisürituste seeriale antud unikaalne identifikaator. Vt 7.7.</td>
</tr>
<tr>
  <td><em>saaja</em></td>
  <td>asutuse, kellele dokument on adresseeritud. Samatähenduslik sõnaga “adressaat”. Vahendamise puhul võib saajana käsitada ka vahendajat. Sõnakasutusest peab alati selguma, kumba silmas peetakse. vt “saatja”.</td>
</tr>
<tr>
  <td><em>saatja</em></td>
  <td>dokumenti saatev asutus; saatja võib kasutada vahendajat. Vahendamise puhul võib ka vahendajat käsitada saatjana. Sõnakasutuse peab alati selguma, kumba silmas peetakse. Vt “saaja”.</td>
</tr>
<tr>
  <td><em>saatev süsteem</em></td>
  <td>dokumenti X-teel DHX protokolli kohaselt saatev infosüsteem (võib olla ka vahendaja infosüsteem).</td>
</tr>
<tr>
  <td><em>teenuse identifikaator</em></td>
  <td>X-tee [X-tee] versiooni 6 nõuete kohane X-tee teenuse identifikaator. Identifitseerib unikaalselt X-tee teenuse nii Eesti X-teel kui ka X-tee implementatsioonide rahvusvahelises võrgus. Koosneb X-tee liikme identifikaatorist, teenuse koodnimetusest ja valikulisest versiooninumbrist. Näiteks: <code>EE/GOV/70003158/DHX/sendDocument</code>.</td>
</tr>
<tr>
  <td><em>vahendaja</em></td>
  <td>vt “DHX vahendaja”.</td>
</tr>
<tr>
  <td><em>vahendatav</em></td>
  <td>asutus, kes on loonud DHX võimekuse vahendaja kaudu. DHX dokumendivahetuses X-teel oma sertifikaadiga ei osale, vaid kasutab vahendaja teenust.</td>
</tr>
<tr>
  <td><em>vahendusnimekiri</em></td>
  <td>DHX dokumendivahendusteenuse vahendaja poolt X-teel teenusena pakutav nimekiri asutustest, keda ta vahendab. Mitte segi ajada DHX vahendajate nimekirjaga.</td>
</tr>
<tr>
  <td><em>üleminekuperiood</em></td>
  <td>Dokumendivahetuskeskuse (DVK) kasutamiselt DHX kasutamisele ülemineku periood. Perioodi alguse ja lõpu määrab X-tee keskus.</td>
</tr>
<tr>
  <td><em>X-tee keskus</em></td>
  <td>X-tee haldaja. X-tee keskuse rolli täidab RIA. X-tee keskus registreerib X-tee alamsüsteeme “DHX” ja peab DHX vahendajate nimekirja.</td>
</tr>
</tbody></table>




<h4 id="4-lähteolukord">4 Lähteolukord</h4>

<ol>
<li><p>DHS-id vahetavad praegu dokumente DVK kaudu, kasutades tingliku nimetusega “DVK protokolli”. “DVK protokolli” määravad elektroonilise andmevahetuse metaandmete loend [Kapsel], DVK liideste spetsifikatsioon [DVK spetsifikatsioon] ja [DVK pidamise kord], laiemas plaanis ka “Asjaajamise ühtsed alused” [AÜK]. Väiksemal arvul on dokumendivahetusliideseid loodud ka muude dokumente töötlevate infosüsteemide vahele. Need liidesed ei ole standarditud. Laienev dokumendiringlus ja dokumente vahetavate infosüsteemide tihenev võrgustik (dokumendivahetus tänapäeval ei piirdu „puhaste“ DHS-dega – dokumente vahetavad ka infosüsteemid, kus dokumendihaldus klassikalises mõttes on ainult üks andmetöötluse liik) nõuab alternatiivi ühe keskse postkastiserveri kaudu toimuvale dokumendiliiklusele.</p>

<p><img src="../img/DHX-Lahteolukord02.PNG" alt="" title=""></p></li>
</ol>

<p>Joonis 1. Lähteolukord: dokumendivahetus DVK kaudu</p>



<h4 id="5-dhx-teenus">5 DHX teenus</h4>



<h4 id="51-üldiseloomustus">5.1 Üldiseloomustus</h4>

<p>DHX teenus on standardse nimemustri ja töötlusloogikaga X-tee teenus, millega asutus saab saata teisele asutusele dokumente.</p>

<p><img src="../img/DHX-Sihtolukord02.PNG" alt="" title=""></p>

<p>Joonis 2. DHX põhiskeem</p>

<p>DHX teenuse kasutamine on interaktsioon, mis koosneb kahest sõnumisaatmisest: <br>
 - dokumendi saatja saadab teenusele <code>sendDocument</code> X-tee päringsõnumi (päringu) <br>
 - dokumendi saaja saadab vastussõnumi kinnitusega dokumendi kättesaamise kohta.</p>

<p>Märkus. Päring- ja vastussõnum moodustavad X-teel standardselt kasutatava nn “sünkroonse” <em>request-response</em> sõnumipaari.  </p>

<p>Kui dokument on valesti adresseeritud või valesti formeeritud, siis saadetakse vastussõnumis asjakohane veateade.</p>

<p>Dokument edastatakse päringsõnumis.</p>

<p>Dokumendid edastatakse nn tõukemeetodil (ingl <em>push</em>). Dokumendi saatja algatab saatmise pöördumisega adressaadi_ <code>sendDocument</code> _teenuse poole.</p>



<h4 id="52-dhx-teenuse-väljaarendamine">5.2 DHX teenuse väljaarendamine</h4>

<p><strong>DHX-i rakendav asutus (või tema DHS vahendusteenuse või DHS majutusteenuse pakkuja) PEAB arendama oma DHS-is välja DHX teenuse ja käitama seda.</strong></p>

<p>Protokoll ei välista olukordi, kus DHS-is luuakse ainult DHX protokolli nõuetele vastav saatmis- või vastuvõtmisvõimekus. Tehniliselt selleks takistusi ei ole. Tehniliselt selleks takistusi pole. Kuna selliste ebasümmeetriliste lahenduste ärivajadus pole selge, siis lihtsuse hoidmise eesmärgist lähtudes protokoll ei sätesta eraldi profiile süsteemidele, mis piirduvad ainult saatmise või vastuvõtmisega.</p>

<p><strong>DHX-i rakendaja teostatud DHX teenus PEAB vastama lisas 1 esitatud täpsemale spetsifikatsioonile.</strong></p>



<h4 id="53-dhx-teenuse-avamine">5.3 DHX teenuse avamine</h4>

<p><strong>DHX-i rakendav asutus PEAB avama DHX teenuse kõigile asutustele, kellega ta soovib dokumente vahetada. Kui asutus turvapoliitika vm kaalutlustel ei pea otstarbekaks DHX teenuse avamist kõigile X-tee liikmetele, siis VÕIB ta DHX teenuse avada konkreetsetele X-tee liikmetele (pääsuõiguste andmisega X-tee turvaserveris).</strong></p>

<p>DHX on mõeldud eelkõige universaalse dokumendivahetuskokkuleppena.</p>

<p><strong>Üleminekuperioodiks PEAB DHX teenuse avama ka DVK-le.</strong></p>

<p>DVK edastab dokumente asutustelt, kes ei ole veel DHX-i võimekust loonud.</p>



<h4 id="54-nimemuster">5.4 Nimemuster</h4>

<p><strong>DHX teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/DHX/sendDocument</code>, kus</strong> <br>
 - <code>EE</code> on X-tee Eesti instantsi nimi <br>
 - <code>&lt;liikmeklass&gt;</code> on X-tee liikmeklass (vastavalt vahendaja õiguslikule vormile kas <code>GOV</code> või <code>PRI</code>)  <br>
 - <code>DHX</code> on teenuse ülesleidmist tagav, käesoleva protokolliga fikseeritud X-tee alamsüsteemi nimi ja <br>
 - <code>&lt;registrikood&gt;</code> on asutuse registrikood.</p>

<p>Näide: <code>EE/GOV/70003158/DHX/sendDocument</code></p>



<h4 id="55-reserveeritud-nimi-dhx">5.5 Reserveeritud nimi “DHX”</h4>

<p><strong>DHX teenus PEAB kasutama X-tee alamsüsteemi “DHX”. X-tee keskus EI TOHI registreerida ühegi asutuse alamsüsteemi “DHX” teiseks otstarbeks.</strong></p>



<h4 id="56-kapsli-kasutamine">5.6 Kapsli kasutamine</h4>

<p><strong>Dokumendi PEAB edastama ametlikult kinnitatud elektroonilise andmevahetuse metaandmete loendile vastavas “kapslis” [Kapsel].</strong></p>

<p>Dokumendi kapslis edastatakse muuhulgas adressaadiks oleva asutuse registrikood.</p>

<hr>

<p>Märkus (informatiivne).</p>

<p>DHX-i kasutuselevõtmisel tekib vajadus täpsustada kapsli [Kapsel] metaandmete elementide tähendust või isegi anda välja uus redaktsioon. Uus redaktsioon on tõenäoliselt mõtet anda välja pärast DHX-ile üleminekuaja lõppu (kui DVK lõplikult käigust eemaldatakse).</p>

<p>Alloleva tabel esitab kommenteeritud nimekirja kapsli elementidest, mida DHX-i kasutuselevõtmine puudutab. Täieliku kapsli elementide spetsifikatsiooniga on võimalik tutvuda [Kapsel].</p>

<h2 id="element-tähendus-dhx-i-kasutamisel-transport-1-dvk-saatja-transport-1-dokumendi-saatja-transport-2-dvk-saaja-transport-2-dokumendi-saaja-xi-dvk-dokumendi-metaandmed-ei-kasutata"><table>
<thead>
<tr>
  <th>element</th>
  <th>tähendus DHX-i kasutamisel</th>
</tr>
</thead>
<tbody><tr>
  <td>Transport  1. DVK Saatja</td>
  <td>Transport  1. Dokumendi saatja</td>
</tr>
<tr>
  <td>Transport  2. DVK Saaja</td>
  <td>Transport  2. Dokumendi saaja</td>
</tr>
<tr>
  <td>XI DVK dokumendi metaandmed</td>
  <td><em>ei kasutata</em></td>
</tr>
</tbody></table>
</h2>



<h4 id="57-unikaalne-identifikaator">5.7 Unikaalne identifikaator</h4>

<p><strong>Saatev süsteem PEAB dokumendi saatmisürituste seeriale andma unikaalse identifikaatori (saadetise id, ingl <em>consignment id</em>).</strong> (Vt ka jaotis 7.7 Uuesti üritamine.)</p>



<h4 id="6-vahendamine">6 Vahendamine</h4>



<h4 id="61-vahendamise-mõiste">6.1 Vahendamise mõiste</h4>

<p>Vahendamise korral osutab dokumentide X-teel saatmise ja vastuvõtmise teenust asutusele vahendaja. Asutus ise X-teega DHX kontekstis ei suhtle. Asutus ei pea isegi olema X-tee liige. Vahendaja esineb X-teel oma nime all. Vahendaja võib olla nii erasektori ettevõte kui ka avaliku sektori asutus.</p>

<p><strong>Asutus VÕIB rakendada DHX-i kas otse (s.t iseseisvalt) või vahendaja kaudu.</strong></p>

<hr>

<p>Märkus (informatiivne). Vahendamine erineb majutamisest. Paljud asutused majutavad oma DHS-e majutus- ja pilveteenuste osutajate juures. Majutamine võib hõlmata nii X-tee turvaserveri kui ka DHS-i majutamist (pilveteenusena osutamist). DHX-i seisukohalt omab tähtsust, kas asutuse DHS suhtleb X-teel asutuse X-tee sertifikaadi abil või mitte. Kõiki suhteid, kus suhtlemine X-teel toimub mitte asutuse enda, vaid teenusepakkuja X-tee sertifikaadi abil, käsitletakse vahendamisena. </p>

<p>Majutamise korral tuleb DHX-i rakendamisel tagada käesoleva protokolli nõuete täitmine. Kuidas seda teha, sõltub konkreetsest suhtest majutaja ja asutuse vahel ning ei ole käesoleva protokolli käsitlusalas.</p>

<hr>

<p>DHX vahendamisel arendab DHX teenuse välja, avab teistele asutustele ja käitab teenust vahendaja. Joonisel 3 on esitatud interaktsiooni põhimõtteskeem vahendamise korral.</p>

<p><img src="../img/DHX-Vahendamine01.PNG" alt="" title=""></p>

<p>Joonis 3 DHX teenusevahendamine</p>

<p>Vahendamisele kehtivad X-tee määrusest tulenevad nõuded: vahendajana end X-teel registreerimise kohustus, andmeteenuse vahendamise korra (poliitika) koostamise ja avalikustamise kohustus jm (vt [X-tee määrus] § 13).</p>



<h4 id="62-vahendajate-nimekiri">6.2 Vahendajate nimekiri</h4>

<p><strong>DHX rakendamisel läbi vahendaja PEAB asutus sõlmima lepingu DHX vahendajaga. Kasutada TOHIB AINULT X-tee keskuse poolt DHX vahendajate nimekirja lisatud vahendajaid.</strong></p>

<p>Vahendajate nimekiri on nimekiri DHX dokumendivahetusteenuse vahendajatest.</p>

<p>Vahendajate nimekirja peab X-tee keskus (RIA).</p>

<p>Tehniliselt teostatakse vahendajate nimekiri DHX vahendajate grupina. DHX vahendajate grupp on osa X-tee globaalsest konfiguratsioonist. Vahendajate nimekiri on X-tee globaalse konfiguratsiooni osana avalikult kättesaadav kõigile X-tee liikmetele. </p>

<p><strong>Vahendajana tegutseda sooviv asutus või ettevõte PEAB end vahendajana X-teel registreerima.</strong> Registreerimise täpse korra kehtestab X-tee keskus.</p>

<p><strong>X-tee keskus PEAB pidama DHX vahendajate nimekirja ajakohasena.</strong> </p>



<h4 id="63-vahendusnimekiri">6.3 Vahendusnimekiri</h4>

<p>Vahendusnimekiri on vahendaja peetav nimekiri asutustest, keda ta vahendab.</p>

<p><strong>Vahendaja PEAB pidama vahendusnimekirja.</strong></p>

<p><strong>Vahendaja PEAB hoidma vahendusnimekirja autentsena ja ajakohasena.</strong> Autentsus tähendab seda, et vahendusnimekiri peab esitama vahendussuhteid tõeselt ja täielikult. Ajakohasus tähendab seda, et vahendusnimekiri peab igal ajahetkel esitame kõik kehtivad vahendussuhted. <strong>Vahendusnimekiri VÕIB sisaldada teavet lõppenud ja tulevikus jõustuvate vahendussuhete kohta (esitatakse väljade <code>startDate</code> ja <code>endDate</code> abil).</strong></p>

<p><strong>Vahendaja PEAB vahendusnimekirja tegema kättesaadavaks X-tee teenusena.</strong></p>

<p><strong>Vahendusnimekirja teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/DHX/representationList</code>, kus</strong> <br>
 - <code>EE</code> on X-tee Eesti instantsi nimi <br>
 - <code>&lt;liikmeklass&gt;</code> on X-tee liikmeklass (väärtus vastavalt X-tee protokollile - vastavalt vahendaja õiguslikule vormile kas <code>GOV</code>, <code>COM</code>, <code>NGO</code> või <code>NEE</code>)  <br>
 - <code>DHX</code> on teenuse ülesleidmist tagav, käesoleva protokolliga fikseeritud X-tee alamsüsteeminimi ja <br>
 - <code>&lt;registrikood&gt;</code> on asutuse registrikood.</p>

<p>Näide: <code>EE/COM/40001111/DHX/representationList</code></p>

<p><strong>DHX-i rakendaja teostatud vahendusnimekirja teenus PEAB vastama lisas 2 esitatud täpsemale spetsifikatsioonile.</strong></p>



<h4 id="7-saatmine">7 Saatmine</h4>



<h4 id="71-dhx-võimekus">7.1 DHX võimekus</h4>

<p><strong>Saatev süsteem PEAB välja selgitama, kas adressaadil on DHX võimekus.</strong></p>

<p>DHX võimekus võib olla otsevõimekus või võimekus vahendaja kaudu.</p>

<hr>

<p>Märkus (informatiivne). Kõnelda võib ka kitsamalt <em>DHX-i saatmisvõimekusest</em> ja <em>DHX-i vastuvõtmisvõimekusest</em>. DHX ei nõua rakendamise sümmeetrilisust: tehnilisi takistusi ainult saatva DHS-i või ainult vastu võtva DHS-i loomisele ei ole. Kuid selliste lahenduste kasutusjuht (<em>use case</em>) pole selge. Sümmeetrilise võimekuse nõude kehtestamine on administratiivne otsus ja jääb käesoleva protokolli käsitlusalast väljapoole. Protokoll eeldab, et osapooled lähtuvad protokolli rakendamisulatuse valimisel reaalsest vajadusest dokumente saata ja saada.</p>

<hr>



<h4 id="72-otsevõimekuse-väljaselgitamine">7.2 Otsevõimekuse väljaselgitamine</h4>

<p><strong>Otsevõimekust PEAB välja selgitama esimeses järjekorras (enne vahendaja kaudu võimekuse tuvastamist).</strong></p>

<p><strong>Saatev süsteem PEAKS otsevõimekuse välja selgitama X-tee globaalse konfiguratsioonifaili põhjal.</strong> Otsevõimekuse tunnuseks on DHX alamsüsteemi olemasolu asutusel. <strong>Globaalse konfiguratsiooni VÕIB alla laadida X-tee keskusest või kasutada X-tee turvaserveri poolt allalaetud, turvaserveri liidese poolt pakutud globaalset konfiguratsioonifaili.</strong></p>

<p><strong>Kui saatev süsteem peab DHX otsevõimekuse väljaselgitamist X-tee globaalse konfiguratsioonifaili põhjal tehniliselt liiga keerukaks, siis VÕIB otsevõimekust kontrollida ka otsese saatmisüritusega.</strong></p>

<p>Kui turvaserver vastab, et adressaadil alamsüsteem DHX puudub, siis sellest võib järeldada, et adressaadil DHX otsevõimekus puudub.</p>

<p>Saatja turvaserver laeb perioodiliselt X-tee keskserverist alla teavet X-tee konfiguratsiooni kohta [PR-GCONF], sh teavet X-tee liikmete poolt määratletud alamsüsteemide ja turvaserverite kohta. Saatja turvaserver teeb ülalnimetatud  konfiguratsiooniteabe põhjal kindlaks, kas adressaat on määratlenud DHX alamsüsteemi. Kui ei ole, siis DHX võimekus puudub.</p>

<p><strong>Adressaadil otsevõimekuse olemasolul PEAB dokumendi saatma adressaadile otse.</strong></p>



<h4 id="73-võimekus-läbi-vahendaja">7.3 Võimekus läbi vahendaja</h4>

<p><strong>Otsevõimekuse puudumise korral PEAB saatev süsteem kontrollima, kas adressaadil on DHX võimekus läbi vahendaja.</strong></p>

<p><strong>DHX võimekuse läbi vahendaja kontrollimiseks PEAB saatev süsteem:</strong> <br>
 - alla laadima X-tee keskusest X-tee globaalse konfiguratsiooni faili või kasutama turvaserveri poolt allalaetud globaalse konfiguratsiooni faili; <br>
 - leidma failist vahendajate nimekirja (DHX vahendajate grupi); <br>
 - käima kõik vahendajad läbi ning pärima X-tee kaudu vahendusnimekirjad; <br>
 - kindlaks tegema, kas adressaat sisaldub vahendusnimekirjades; <br>
 - kontrollima vahendussuhte ajalist kehtivust (teenuse <code>representationList</code> vastussõnumi väljade <code>startDate</code> ja <code>endDate</code> abil).</p>

<p><strong>Kui adressaadil puudub DHX otsevõimekus, kuid on DHX võimekus läbi vahendaja, siis PEAB saatev süsteem saatma dokumendi vahendajale.</strong></p>



<h4 id="74-lokaalne-aadressiraamat">7.4 Lokaalne aadressiraamat</h4>

<p><strong>Saatev süsteem VÕIB DHX-i võimekuse väljaselgitamise tulemust puhverdada, moodustades nn lokaalse aadressiraamatu. Puhvri (lokaalse aadressiraamatu) värskendamise periood PEAB olema konfigureeritav.</strong></p>



<h4 id="75-saatmine-dvk-sse">7.5 Saatmine DVK-sse</h4>

<p><strong>Kui saatev süsteem on kindlaks teinud, et adressaadil puudub DHX võimekus ja käimas on üleminekuperiood, siis PEAB saatev süsteem üritama dokumenti saata DVK <code>sendDocument</code> teenusesse.</strong></p>

<p>Tegu on juhuga, kus adressaat ei ole veel DHX-i võimekust loonud. Adressaat võib olla veel DVK kasutaja. DVK saadab <code>sendDocument</code> teenusesse saadetud dokumendi adressaadile edasi. Kui adressaat ei ole DVK kasutaja, siis teatab DVK_ <code>adressaat tundmatu</code>_. Saatev süsteem on kõik võimalused ammendanud ja tuleb konstateerida, et dokumenti ei saa edastada - vähemalt seni, kuni adressaat ei ole DHX võimekust loonud.</p>



<h4 id="76-dokumendi-lugemine-edastatuks">7.6 Dokumendi lugemine edastatuks</h4>

<p><strong>Saatev süsteem PEAB lugema dokumendi edastatuks, kui on saanud <code>sendDocument</code> teenuselt positiivse vastuskoodiga vastussõnumi.</strong></p>

<p>Kinnitus dokumendi kättesaamise kohta saadetakse X-tee päring-vastus (<em>request</em>-<em>response</em>) sõnumipaari vastussõnumis. Kui osapooled vajavad kõrgema äriloogika kihi taseme kinnitusi, siis neid võib realiseerida DHX protokolli väliselt või DHX protokolli pealiskihina.</p>



<h4 id="77-uuesti-üritamine">7.7 Uuesti üritamine</h4>

<p><strong>Kui adressaadiga ei saa ühendust või kättesaamise kinnitust ei tule, siis PEAB mõne aja pärast saatmist uuesti üritama.</strong></p>

<hr>

<p>Märkus (informatiivne). Uuestisaatmise teostamisel võib võrdluseks võtta DVK-ga liidestatud DHS-des kasutatud loogikat.</p>

<hr>

<p><strong>Tühipäringute arvu vähendamiseks PEAKS kasutada eksponentsiaalse taganemise (<em>exponential back-off</em>) algoritmi [EXP].</strong></p>

<p><strong>Saatmisürituste arv PEAB olema lõplik ja saatva süsteemi konfiguratsioonis määratav.</strong> </p>



<h4 id="78-saatmisalgoritm-informatiivne">7.8 Saatmisalgoritm (informatiivne)</h4>

<p>Alljärgnev saatmisalgoritm illustreerib üht võimalikku viisi programmiliselt teostada dokumendi saatmist. Algoritmis on kasutatud Go keele [GOLANG] konstruktsioone. Algoritm on informatiivse tähendusega. Protokolli implementeerija võib saatmisega seotud nõuded täita oma valitud viisil. Algoritm ei käsitle kapsli koostamist.</p>

<ul>
<li>Funktsioon <code>adressaat_kasutab_DHXi_otse</code> selgitab välja, kasutades X-tee globaalset konfiguratsiooni, kas asutusel <code>a</code> on DHX-i otsevõimekus.</li>
<li>Funktsioon <code>adressaat_kasutab_vahendajat</code> selgitab välja, kasutades X-tee gruppi <code>DHX vahendajad</code> ja vahendajate X-tee teenuseid <code>representationList</code>, kas asutus <code>a</code> kasutab DHX-i teenusevahendajat.</li>
<li>Funktsioon <code>yritaSaata</code> üritab saata dokumenti <code>d</code> X-tee liikme <code>vastuvõtja</code> alamsüsteemi <code>DHX</code> teenusele <code>sendDocument</code>. Kui saatmine õnnestub, siis tagastab <code>true</code>.</li>
<li>Funktsioon <code>vahendaja_registrikood</code> leiab asutuse <code>a</code> vahendaja registrikoodi.</li>
<li>Funktsiooni <code>saadaDokument</code> kutsub välja ülalnimetatud funktsioone ja korraldab dokumendi <code>d</code> saatmise adressaadile registrikoodiga <code>a</code>. Tehakse kolm saatmisüritust, teist korda üritades peetakse vahet üks tund ja kolmandat korda üritades üks ööpäev.  </li>
</ul>



<pre class="prettyprint"><code class="language-Go hljs livecodeserver"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saadaDokument</span>(<span class="hljs-title">d</span> <span class="hljs-title">Dokument</span>, <span class="hljs-title">a</span> <span class="hljs-title">Registrikood</span>) {</span>
    var vastuvotja<span class="hljs-comment"> // asutus, kellele süsteemile dokument teele panna (v.o vahendaja)</span>
    var saatmisyritus = <span class="hljs-number">0</span><span class="hljs-comment"> // saatmisürituse järjenumber</span>
    var maksimaalseltSaatmisyritusi = <span class="hljs-number">3</span><span class="hljs-comment"> // väärtus p.o konfigureeritav</span>

   <span class="hljs-comment"> // kõigepealt selgitatakse välja, kas adressaat rakendab DHX-i otse</span>
    <span class="hljs-keyword">if</span> adressaat_kasutab_DHXi_otse(<span class="hljs-operator">a</span>) { 
      vastuvotja = <span class="hljs-operator">a</span>
   <span class="hljs-comment"> // kui otse ei rakenda, siis kas vahendaja kaudu?  </span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> adressaat_kasutab_vahendajat(<span class="hljs-operator">a</span>) {  
      vastuvotja = vahendaja_registrikood(<span class="hljs-operator">a</span>)
   <span class="hljs-comment"> // kui DHX-i võimekus puudub, siis üleminekuperioodil proovitakse saata veel DVK-sse  </span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> yleminekuperiood_kestab() { 
      vastuvotja = DVK
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-constant">return</span> <span class="hljs-string">"Ei saa saata."</span> 
    }

   <span class="hljs-comment"> // saatmisüritused</span>
    <span class="hljs-keyword">for</span> saatmisyritus &lt; maksimaalseltSaatmisyritusi {
      saatmisyritus = saatmisyritus + <span class="hljs-number">1</span>
     <span class="hljs-comment"> // Viivitusaeg enne saatmisürituse kordamist</span>
      <span class="hljs-keyword">if</span> saatmisyritus == <span class="hljs-number">2</span> {
        <span class="hljs-built_in">time</span>.Sleep(<span class="hljs-built_in">time</span>.Hour)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> saatmisyritus == <span class="hljs-number">3</span> {
        <span class="hljs-built_in">time</span>.Sleep(<span class="hljs-number">24</span> * <span class="hljs-built_in">time</span>.Hour)
      }
      <span class="hljs-keyword">if</span> yritaSaata(d, vastuvotja) {<span class="hljs-comment"> // saatmine edukas</span>
        <span class="hljs-constant">return</span> <span class="hljs-string">"Saatmine edukas"</span>
      }
    }

    <span class="hljs-constant">return</span> maksimaalseltSaatmisyritus + <span class="hljs-string">" üritust, kõik ebaõnnestusid"</span>
}</code></pre>



<h4 id="8-vastuvõtmine">8 Vastuvõtmine</h4>



<h4 id="81-aadressi-kontroll">8.1 Aadressi kontroll</h4>

<p><strong>Vastuvõttev süsteem PEAB kontrollima, et dokument on saadetud õigele aadressile.</strong></p>

<p><strong>Vahendamise puhul PEAB vastuvõttev süsteem kontrollima, kas adressaat on vahendaja klient (on vahendusnimekirjas).</strong></p>



<h4 id="82-valest-aadressist-teatamine">8.2 Valest aadressist teatamine</h4>

<p><strong>Valesti adresseeritud dokumendi korral PEAB vastuvõttev süsteem saatma saatjale veateate <code>Vale aadress</code>.</strong></p>



<h4 id="83-kapsli-kontroll">8.3 Kapsli kontroll</h4>

<p><strong>Vastuvõttev süsteem PEAB kontrollima, et dokument tuli nõuetekohases kapslis. Kontroll PEAB sisaldama vähemalt XML skeemile vastavuse kontrollimist. Vigase kapsli korral PEAB saatma vastava veateate <code>Vigane kapsel</code>. Vastuvõttev süsteem VÕIB teha täiendavaid kontrolle semantilisel või äriloogikalisel tasandil.</strong></p>



<h4 id="84-mitme-aadressi-käsitlus">8.4 Mitme aadressi käsitlus</h4>

<p><strong>Vahendajana tegutsev süsteem PEAB mitmele aadressile saadetud dokumendi edastama kõigile oma klientidele, kes on dokumendi kapsli transpordiblokis adressaatidena nimetatud.</strong></p>



<h4 id="85-vastuvõtmine-dvk-st">8.5 Vastuvõtmine DVK-st</h4>

<p><strong>DHX-i võimekuse loonud süsteem PEAB üleminekuperioodil dokumente vastu võtma ka DVK-st.</strong></p>

<p>Tehniliselt seisneb see selles, et DHX-le üleläinud süsteem peab avama oma DHX teenuse ka DVK-le. DVK edastab dokumente nendelt asutustelt, kes ei ole veel DHX-le üle läinud.</p>



<h4 id="86-saatja-kindlakstegemine">8.6 Saatja kindlakstegemine</h4>

<p>Dokumendi saatja saab kindlaks teha kahel viisil: 1) dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete abil; 2) X-tee päringsõnumi X-tee päiseväljade <code>client</code> [PR-MESS] ja <code>representedParty</code> [X-EXT] abil.</p>

<hr>

<p>Märkus (informatiivne). Vastavalt X-tee sõnumiprotokolli kolmanda osapoole esindamise laiendusele peab vahendaja märkima asutuse, keda ta esindab, X-tee sõnumipäisesse välja <code>representedParty</code> [X-EXT].</p>

<hr>

<p>Vastuvõttev süsteem PEAB kontrollima dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete ja X-tee päringsõnumi X-tee päiseväljade <code>client</code> ja <code>representedParty</code> kooskõlalisust. Lahknevuste korral PEAB dokumendi tagasi lükkama.</p>

<p><strong>Vahendajalt dokumendi vastuvõtmisel PEAB kontrollima, kas vahendaja on vahendajate nimekirjas. Kontrolli tulemust VÕIB puhverdada.</strong></p>



<h4 id="9-üleminek">9 Üleminek</h4>



<h4 id="91-üleminekuperiood">9.1 Üleminekuperiood</h4>

<p>Üleminek DHX protokollile toimub etteantud perioodi jooksul. Üleminekuperiood algab kõigile asutustele üheaegselt. Perioodi algusest teavitab X-tee keskus. Üleminekuperiood lõpeb DVK tegevuse lõpetamisega.</p>

<hr>

<p>Toimimine üleminekuperioodil (informatiivne)</p>

<p>Üleminekuperioodil arendavad asutused välja oma DHS-des DHX protokolli kohase dokumentide saatmise ja vastuvõtmise võimekuse. Tehniliselt tähendab “DHX-i võimekus” DHX protokolli kohase X-tee teenuse pakkumist ja võimet teiste asutuste samasuguse teenuse poole pöörduda.</p>

<p>DHX-i võimekus ei teki asutustes üheaegselt, sest arendused valmivad erinevatel aegadel. Joonis 4 selgitab DHX-le üle läinud ja veel üle minemata süsteemide koostoimimist üleminekuperioodil.</p>

<p><img src="../img/DHX-Yleminek01.PNG" alt="" title=""></p>

<p>Joonis 4. Toimimine üleminekuperioodil</p>

<p>Asutused 1 ja 2 on üle läinud DHX protokollile ja vahetavad dokumente üksteisega DHX-i abil otse. Asutus 3 kasutab veel vana, “DVK protokolli”.</p>

<p>DVK täidab üleminekuperioodil uue ja vana protokolli (DHX-i ja DVK) vahelise teisendaja rolli. </p>

<p>UK tähistab RIA poolt väljatöötatavat “universaalset tarkvarakomponenti”, mille eesmärgiks on kergendada DHS-de ümberhäälestamist DHX-i kasutamisele. UK kasutamine ei ole kohustuslik.</p>

<hr>

<p><strong>Üleminekuperioodil niipea, kui asutuse DHS-is on tekkinud DHX protokolli võimekus (arendus on lõppenud), PEAB hakkama dokumendi saatmisel kasutama DHX teenust.</strong></p>

<p><strong>Üleminekuperioodil kui osutub, et adressaat ei ole veel dokumentide vastuvõtmise DHX-teenust loonud (teenus ei ole X-teel leitav), siis PEAB dokumendi saatma DVK kaudu, kasutades DVK teenust <code>sendDocument</code> ja märkides adressaadi dokumendi metaandmete kapslis.</strong></p>

<p><strong>DHX võimekuse saavutanud asutus PEAB DVK kasutamisest loobuma.</strong></p>



<h4 id="92-dvk-toimimine-üleminekuperioodil">9.2 DVK toimimine üleminekuperioodil</h4>

<p>DVK-d hoitakse töös kogu üleminekuperioodi vältel. DVK-d täiendatakse üleminekuperioodil toimimiseks vajaliku funktsionaalsusega.</p>

<p>DVK pakub teenust <code>sendDocument</code>, millega DHX-i võimekuse loonud asutus saab edastada dokumendi edasisaatmiseks DHX võimekust veel mitteomavale asutusele. Edasisaatmise teostab DVK.</p>

<p>DVK toimib üleminekuperioodil DHX teenusevahendajana (RIA lisatakse vahendajate nimekirja).</p>

<p>DHX-i võimekuse loonud asutusele adresseeritud dokumendi laekumisel DVK-sse üritab DVK seda kohe edasi saata.</p>

<p>DVK lülitatakse välja siis, kui kõik DVK asutused on DHX protokolli võimekuse loonud või üleminekuperioodi tähtaja saabudes.</p>



<h4 id="10-vastavusnõuded">10 Vastavusnõuded</h4>

<p>Käesolev jaotis võtab kokku nõuded (ingl <em>conformance criteria</em>, vt nt RFC 2049), mis peavad olema täidetud, et dokumente vahetava süsteemi saaks deklareerida DHX-le vastavaks.</p>

<p>Alljärgnev käsitlus piirdub koostalitlusvõimet tagavate tarkvaratehniliselt rakendatavate meetmetega ja süsteemide tehniliste omadustega. DHX dokumendivahetuse korraldamiseks võivad dokumendivahetuse osapooled ja koordinaatorid kehtestada mitmesuguseid (täiendavaid) organisatsioonilisi meetmeid. Need ei ole protokolli käsitlusalas.  </p>



<h4 id="101-vastavusnõuded-kõigile-dhx-dokumente-vahetavatele-süsteemidele">10.1 Vastavusnõuded kõigile DHX dokumente vahetavatele süsteemidele</h4>

<table>
<thead>
<tr>
  <th>jaotis</th>
  <th>nõue</th>
</tr>
</thead>
<tbody><tr>
  <td>5.2</td>
  <td>DHX-i rakendav asutus (või tema DHS vahendusteenuse või DHS majutusteenuse pakkuja) PEAB arendama oma DHS-is välja DHX teenuse ja käitama seda.</td>
</tr>
<tr>
  <td>5.2</td>
  <td>DHX-i rakendaja teostatud DHX teenus PEAB vastama lisas 1 esitatud täpsemale spetsifikatsioonile.</td>
</tr>
<tr>
  <td>5.3</td>
  <td>DHX-i rakendav asutus PEAB avama DHX teenuse kõigile asutustele, kellega ta soovib dokumente vahetada. Kui asutus turvapoliitika vm kaalutlustel ei pea otstarbekaks DHX teenuse avamist kõigile X-tee liikmetele, siis VÕIB ta DHX teenuse avada konkreetsetele X-tee liikmetele (pääsuõiguste andmisega X-tee turvaserveris).</td>
</tr>
<tr>
  <td>5.3</td>
  <td>Üleminekuperioodiks PEAB DHX teenuse avama ka DVK-le.</td>
</tr>
<tr>
  <td>5.4</td>
  <td>DHX teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/DHX/sendDocument</code>.</td>
</tr>
<tr>
  <td>5.5</td>
  <td>DHX teenus PEAB kasutama X-tee alamsüsteemi “DHX”.</td>
</tr>
<tr>
  <td>5.6</td>
  <td>Dokumendi PEAB edastama ametlikult kinnitatud elektroonilise andmevahetuse metaandmete loendile vastavas “kapslis”.</td>
</tr>
<tr>
  <td>5.7</td>
  <td>Saatev süsteem PEAB dokumendi saatmisürituste seeriale andma unikaalse identifikaatori (saadetise id, ingl <em>consignment id</em>).</td>
</tr>
<tr>
  <td>6.2</td>
  <td>DHX rakendamisel läbi vahendaja PEAB asutus sõlmima lepingu DHX vahendajaga. Kasutada TOHIB AINULT X-tee keskuse poolt DHX vahendajate nimekirja lisatud vahendajaid.</td>
</tr>
<tr>
  <td>7.1</td>
  <td>Saatev süsteem PEAB välja selgitama, kas adressaadil on DHX võimekus.</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Otsevõimekust PEAB välja selgitama esimeses järjekorras (enne vahendaja kaudu võimekuse tuvastamist).</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Saatev süsteem PEAKS otsevõimekuse välja selgitama X-tee globaalse konfiguratsioonifaili põhjal.</td>
</tr>
<tr>
  <td>7.2</td>
  <td>Adressaadil otsevõimekuse olemasolul PEAB dokumendi saatma adressaadile otse.</td>
</tr>
<tr>
  <td>7.3</td>
  <td>DHX võimekuse läbi vahendaja kontrollimiseks PEAB saatev süsteem: a) alla laadima X-tee keskusest X-tee globaalse konfiguratsiooni faili või kasutama turvaserveri poolt allalaetud globaalse konfiguratsiooni faili; b) leidma failist vahendajate nimekirja (DHX vahendajate grupi); c) käima kõik vahendajad läbi ning pärima X-tee kaudu vahendusnimekirjad; d)     kindlaks tegema, kas adressaat sisaldub vahendusnimekirjades.</td>
</tr>
<tr>
  <td>7.3</td>
  <td>Kui adressaadil puudub DHX otsevõimekus, kuid on DHX võimekus läbi vahendaja, siis PEAB saatev süsteem saatma dokumendi vahendajale.</td>
</tr>
<tr>
  <td>7.4</td>
  <td>Puhvri (lokaalse aadressiraamatu) kasutamisel PEAB värskendamise periood olema konfigureeritav.</td>
</tr>
<tr>
  <td>7.5</td>
  <td>Kui saatev süsteem on kindlaks teinud, et adressaadil puudub DHX võimekus ja käimas on üleminekuperiood, siis PEAB saatev süsteem üritama dokumenti saata DVK sendDocument teenusesse.</td>
</tr>
<tr>
  <td>7.6</td>
  <td>Saatev süsteem PEAB lugema dokumendi edastatuks, kui on saanud <code>sendDocument</code> teenuselt positiivse vastuskoodiga vastussõnumi.</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Kui adressaadiga ei saa ühendust või kättesaamise kinnitust ei tule, siis PEAB mõne aja pärast saatmist uuesti üritama.</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Tühipäringute arvu vähendamiseks PEAKS kasutada eksponentsiaalse taganemise (<em>exponential back-off</em>) algoritmi [EXP].</td>
</tr>
<tr>
  <td>7.7</td>
  <td>Saatmisürituste arv PEAB olema lõplik ja saatva süsteemi konfiguratsioonis määratav.</td>
</tr>
<tr>
  <td>8.1</td>
  <td>Vastuvõttev süsteem PEAB kontrollima, et dokument on saadetud õigele aadressile.</td>
</tr>
<tr>
  <td>8.1</td>
  <td>Vahendamise puhul PEAB vastuvõttev süsteem kontrollima, kas adressaat on vahendaja klient (on vahendusnimekirjas).</td>
</tr>
<tr>
  <td>8.2</td>
  <td>Valesti adresseeritud dokumendi korral PEAB vastuvõttev süsteem saatma saatjale veateate <code>Vale aadress</code>.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Vastuvõttev süsteem PEAB kontrollima, et dokument tuli nõuetekohases kapslis.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Kontroll PEAB sisaldama vähemalt XML skeemile vastavuse kontrollimist.</td>
</tr>
<tr>
  <td>8.3</td>
  <td>Vigase kapsli korral PEAB saatma vastava veateate <code>Vigane kapsel</code>.</td>
</tr>
<tr>
  <td>8.5</td>
  <td>DHX-i võimekuse loonud süsteem PEAB üleminekuperioodil dokumente vastu võtma ka DVK-st.</td>
</tr>
<tr>
  <td>8.6</td>
  <td>Vastuvõttev süsteem PEAB kontrollima dokumendi kapslis sisalduvate saatjat kirjeldavate metaandmete ja X-tee päringsõnumi X-tee päiseväljade <code>client</code> ja <code>representedParty</code> kooskõlalisust. Lahknevuste korral PEAB dokumendi tagasi lükkama.</td>
</tr>
<tr>
  <td>8.6</td>
  <td>Vahendajalt dokumendi vastuvõtmisel PEAB kontrollima, kas vahendaja on vahendajate nimekirjas. Kontrolli tulemust VÕIB puhverdada.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>Üleminekuperioodil niipea, kui asutuse DHS-is on tekkinud DHX protokolli võimekus (arendus on lõppenud), PEAB hakkama dokumendi saatmisel kasutama DHX teenust.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>Üleminekuperioodil kui osutub, et adressaat ei ole veel dokumentide vastuvõtmise DHX-teenust loonud (teenus ei ole X-teel leitav), siis PEAB dokumendi saatma DVK kaudu, kasutades DVK teenust <code>sendDocument</code> ja märkides adressaadi dokumendi metaandmete kapslis.</td>
</tr>
<tr>
  <td>9.1</td>
  <td>DHX võimekuse saavutanud asutus PEAB DVK kasutamisest loobuma.</td>
</tr>
</tbody></table>




<h4 id="102-vahendajate-süsteemidele-rakenduvad-nõuded">10.2 Vahendajate süsteemidele rakenduvad nõuded</h4>

<table>
<thead>
<tr>
  <th>jaotis</th>
  <th>nõue</th>
</tr>
</thead>
<tbody><tr>
  <td>6.2</td>
  <td>Vahendajana tegutseda sooviv asutus või ettevõte PEAB end vahendajana X-teel registreerima.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Iga vahendaja PEAB pidama vahendusnimekirja.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendaja PEAB hoidma vahendusnimekirja ajakohasena.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendaja PEAB vahendusnimekirja tegema kättesaadavaks X-tee teenusena.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>Vahendusnimekirja teenuse nimi PEAB järgima mustrit <code>EE/&lt;liikmeklass&gt;/&lt;registrikood&gt;/DHX/representationList</code>.</td>
</tr>
<tr>
  <td>6.3</td>
  <td>DHX-i rakendaja teostatud vahendusnimekirja teenus PEAB vastama lisas 2 esitatud täpsemale spetsifikatsioonile.</td>
</tr>
<tr>
  <td>8.4</td>
  <td>Vahendajana tegutsev süsteem PEAB mitmele aadressile saadetud dokumendi edastama kõigile oma klientidele, kes on dokumendi kapsli transpordiblokis adressaatidena nimetatud.</td>
</tr>
</tbody></table>




<h4 id="viited">Viited</h4>

<p>[AÜK] Vabariigi Valitsuse määrus „Asjaajamiskorra ühtsed alused“, <a href="https://www.riigiteataja.ee/akt/130122011062?leiaKehtiv">https://www.riigiteataja.ee/akt/130122011062?leiaKehtiv</a>.</p>

<p>[DVK] Dokumendivahetuskeskus (DVK). Riigi Infosüsteemi Amet. <a href="https://www.ria.ee/dokumendivahetus">https://www.ria.ee/dokumendivahetus</a>.</p>

<p>[DVK pidamise kord] Dokumendivahetuskeskuse pidamise kord. Riigi Infosüsteemi Amet. <a href="https://www.ria.ee/public/dvk_kord.pdf">https://www.ria.ee/public/dvk_kord.pdf</a>.</p>

<p>[DVK spetsifikatsioon] Dokumendivahetuskeskus (DVK). Liideste spetsifikatsioon 1.6.0.  <a href="https://svn.eesti.ee/projektid/dvk/doc/dvk_spetsifikatsioon_1.6.0.odt">https://svn.eesti.ee/projektid/dvk/doc/dvk_spetsifikatsioon_1.6.0.odt</a>.</p>

<p>[DH metaandmed] Dokumendihalduse metaandmed. Loend 3.0. Majandus- ja Kommunikatsiooniministeerium <a href="https://www.mkm.ee/sites/default/files/dokumendihalduse_metaandmed.pdf">https://www.mkm.ee/sites/default/files/dokumendihalduse_metaandmed.pdf</a>.</p>

<p>[EXP] Exponential backoff. <a href="https://en.wikipedia.org/wiki/Exponential_backoff">https://en.wikipedia.org/wiki/Exponential_backoff</a>.</p>

<p>[GOLANG] The Go Programming Language. <a href="https://golang.org/">https://golang.org/</a>.</p>

<p>[Kapsel] Elektroonilise andmevahetuse metaandmete loend 2.1. Riigi Infosüsteemi Amet.  <a href="https://riha.eesti.ee/riha/main/xml/elektroonilise_andmevahetuse_metaandmete_loend/1">https://riha.eesti.ee/riha/main/xml/elektroonilise_andmevahetuse_metaandmete_loend/1</a>.</p>

<p>[MIT] MIT License. <a href="https://github.com/e-gov/DHX/blob/master/LICENCE.txt">https://github.com/e-gov/DHX/blob/master/LICENCE.txt</a>.</p>

<p>[PR-GCONF] <a href="http://x-road.eu/docs/x-road_protocol_for_downloading_configuration.pdf">X-Road Protocol for Downloading Configuration</a>.</p>

<p>[PR-META] <a href="https://www.ria.ee/public/x_tee/pr-meta_x-road_service_metadata_protocol_2.1.3_Y-743-14.pdf">X-Road Service Metadata Protocol</a>.</p>

<p>[PR-MESS] <a href="http://x-road.eu/docs/x-road_message_protocol_v4.0.pdf">X-Road Message Protocol v4.0</a></p>

<p>[RIA-PP] <a href="https://github.com/e-gov/Open-Workflow/blob/master/ProtokollideParimPraktika.md">Protokollide spetsifitseerimise parim praktika</a>. Riigi Infosüsteemi Amet. 2015.</p>

<p>[RFC 2119] <a href="https://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>.</p>

<p>[RFC 2049] <a href="https://tools.ietf.org/html/rfc2049">RFC 2045 Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>.</p>

<p>[RFC 6852] <a href="https://tools.ietf.org/html/rfc6852">RFC 6852 Affirmation of the Modern Paradigm for Standards</a>.</p>

<p>[UG-SIGDOC] <a href="http://x-road.eu/docs/x-road_signed_document_download_and_verification_manual.pdf">X-Road: Signed Document Download and Verification Manual</a>. </p>

<p>[X-EXT] X-tee v6 sõnumiprotokolli kolmanda osapoole esindamise laiendus, <a href="https://www.ria.ee/public/x_tee/Third_party_representation_extension_v1.0.0.pdf">https://www.ria.ee/public/x_tee/Third_party_representation_extension_v1.0.0.pdf</a>.</p>

<p>[X-tee] Andmevahetuskiht X-tee, <a href="https://www.ria.ee/x-tee/">https://www.ria.ee/x-tee/</a>.</p>

<p>[X-tee määrus] Vabariigi Valitsuse määrus “Infosüsteemide andmevahetuskiht” (eelnõu 09.03.2016). </p>



<h4 id="lisa-1-senddocument-spetsifikatsioon">Lisa 1 sendDocument spetsifikatsioon</h4>

<p>Spetsifikatsioon asub <a href="sendDocument.md">eraldi failis</a>.</p>



<h4 id="lisa-2-representationlist-spetsifikatsioon">Lisa 2 representationList spetsifikatsioon</h4>

<p>Spetsifikatsioon asub <a href="representationList.md">eraldi failis</a>.</p>


			</div>
		</div>
	</div>
	
</body>
</html>
